<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Setting up a lab with VMWare workstation</title>
	
	<meta name="author" content="raesene">

	<!-- Enable responsive viewport -->
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

	<!-- Le styles -->
	<link href="/assets/resources/bootstrap/css/bootstrap.min.css" rel="stylesheet">
	<link href="/assets/resources/font-awesome/css/font-awesome.min.css" rel="stylesheet">
	<link href="/assets/resources/syntax/syntax.css" rel="stylesheet">
	<link href="/assets/css/style.css" rel="stylesheet">

	<!-- Le fav and touch icons -->
	<!-- Update these with your own images
	<link rel="shortcut icon" href="images/favicon.ico">
	<link rel="apple-touch-icon" href="images/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
	-->

	<link rel="alternate" type="application/rss+xml" title="" href="/feed.xml">
</head>

<body>
	<nav class="navbar navbar-default visible-xs" role="navigation">
		<!-- Brand and toggle get grouped for better mobile display -->
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			
			<a type="button" class="navbar-toggle nav-link" href="https://github.com/raesene">
				<i class="fa fa-github"></i>
			</a>
			
			
			<a type="button" class="navbar-toggle nav-link" href="https://twitter.com/raesene">
				<i class="fa fa-twitter"></i>
			</a>
			
			
			<a type="button" class="navbar-toggle nav-link" href="mailto:raesene@gmail.com">
				<i class="fa fa-envelope"></i>
			</a>
			
			<a class="navbar-brand" href="/">
				<img src="https://www.gravatar.com/avatar/8c189c784a607c4b5d52b0c7ee69b036?s=35" class="img-circle" />
				
			</a>
		</div>

		<!-- Collect the nav links, forms, and other content for toggling -->
		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			<ul class="nav navbar-nav">
				<li class="active"><a href="/">Home</a></li>
				<li><a href="/categories/index.html">Categories</a></li>
				<li><a href="/tags/index.html">Tags</a></li>
			</ul>
		</div><!-- /.navbar-collapse -->
	</nav>

	<!-- nav-menu-dropdown -->
	<div class="btn-group hidden-xs" id="nav-menu">
		<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
			<i class="fa fa-bars"></i>
		</button>
		<ul class="dropdown-menu" role="menu">
			<li><a href="/"><i class="fa fa-home"></i>Home</a></li>
			<li><a href="/categories/index.html"><i class="fa fa-folder"></i>Categories</a></li>
			<li><a href="/tags/index.html"><i class="fa fa-tags"></i>Tags</a></li>
			<li class="divider"></li>
			<li><a href="#"><i class="fa fa-arrow-up"></i>Top of Page</a></li>
		</ul>
	</div>

	<div class="col-sm-3 sidebar hidden-xs">
		<!-- sidebar.html -->
<header class="sidebar-header" role="banner">
	<a href="/">
		<img src="https://www.gravatar.com/avatar/8c189c784a607c4b5d52b0c7ee69b036?s=150" class="img-circle" />
	</a>
	<h3 class="title">
        <a href="/"></a>
    </h3>
</header>


<div id="bio" class="text-center">
	Security Geek, Penetration Testing, Docker, Ruby, Hillwalking
</div>


<div id="contact-list" class="text-center">
	<ul class="list-unstyled list-inline">
		
		<li>
			<a class="btn btn-default btn-sm" href="https://github.com/raesene">
				<i class="fa fa-github-alt fa-lg"></i>
			</a>
		</li>
		
		
		<li>
			<a class="btn btn-default btn-sm" href="https://twitter.com/raesene">
				<i class="fa fa-twitter fa-lg"></i>
			</a>
		</li>
		
		
		<li>
			<a class="btn btn-default btn-sm" href="mailto:raesene@gmail.com">
				<i class="fa fa-envelope fa-lg"></i>
			</a>
		</li>
		
	</ul>
	<ul id="contact-list-secondary" class="list-unstyled list-inline">
		
		
		<li>
			<a class="btn btn-default btn-sm" href="https://linkedin.com/in/rorym">
				<i class="fa fa-linkedin fa-lg"></i>
			</a>
		</li>
		
		<li>
			<a class="btn btn-default btn-sm" href="/feed.xml">
				<i class="fa fa-rss fa-lg"></i>
			</a>
		</li>
	</ul>
</div>
<!-- sidebar.html end -->

	</div>

	<div class="col-sm-9 col-sm-offset-3">
		<div class="page-header">
  <h1>Setting up a lab with VMWare workstation </h1>
</div>
	
<article>

	<div class="col-sm-10">
	 <span class="post-date">
	   
	   May 
	   10th,
	   
	   2014
	 </span>
	  <div class="article_body">
	  <p>This took me a little while to track down all the piece so possibly worth a blog post (if for no other reason that so I can find it again).</p>

<p>I’ve often thought that VMWare Workstation is under appreciated as a tool.  I’ve been using since v1 (must be about 15 years now) and it’s always been a key piece of software for me.  Although I know there are other alternatives none of them seem to combine the flexibility and stability of Workstation.</p>

<p>So today I’m setting up a lab for a training course and I wanted a series of guest machines with the same build and different IP addresses (a pretty standard requirement for student machines for training courses) and I was looking for a way to automate the process of creating a clone, changing the clones IP address and then rebooting the box to get the new IP address in place (restarting networking would likely work as well here obv.)</p>

<p>In looking for a solution I came across a part of VMWare Workstation that I’ve never come across before, <a href="https://www.vmware.com/pdf/vix162_vmrun_command.pdf">vmrun</a>.</p>

<p>Basically vmrun lets you carry out various actions on a virtual machine from the command line.  This includes the obvious ones like starting/stopping/cloning but also includes runProgramInGuest which lets you pass commands to the guest OS, handy!</p>

<p>so using a set of vmrun commands I came up with the following to automate the process</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vmrun.exe -T ws clone &lt;source_vmx_file&gt; &lt;destination_vmx_file&gt; linked
</code></pre></div></div>
<p>This creates a linked clone of the VM.  You need to specify the actual vmx file rather than just the directory.  Worth noting that for the destination vmrun will create the parent directory for the vmx file as specified.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vmrun.exe -T ws start &lt;destination_vmx_file&gt; gui
</code></pre></div></div>
<p>This starts your destination VM.  The option at the end can be gui or nogui, so if you like you can start up the VM with no gui, handy for a batch job or remote work.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vmrun.exe -T ws -gu &lt;user&gt; -gp &lt;password&gt; runProgramInGuest &lt;destination_vmx_file&gt; /usr/bin/sudo /bin/sed -i "/address 192.168.41.98$/caddress 192.168.41.131" /etc/network/interfaces
</code></pre></div></div>
<p>This is a quick oneliner to change the IP address on a debian based machine that has a static IP address set (NB this may well barf if there’s more that one address line in the file). The user and password here are the guest ones as vmrun is actually logging in to the box.  Also note that your user will either need to be root (in which case drop the sudo bit off) or have NOPASSWD sudo access.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vmrun.exe -T ws -gu &lt;user&gt; -gp &lt;password&gt; runProgramInGuest &lt;destination_vmx_file&gt; /usr/bin/sudo /sbin/init 6
</code></pre></div></div>
<p>This just reboots the box, you could also just bounce the network here of course.</p>

<p>For my script running this on windows I also added a quick variable for the IP address so I can easily change it for different machines.</p>

<p>Anyway nothing earth shaking here, but I’ll tell you if you’ve got 40 guest machines to set-up for a Lab something like this is v. handy!</p>

	  </div>

		
		<ul class="tag_box list-unstyled list-inline">
		  <li><i class="fa fa-folder-open"></i></li>
		  
		  
			 
				<li><a href="/categories/index.html#Vmware-ref">
					Vmware <span>(1)</span>
					,
				</a></li>
			 
				<li><a href="/categories/index.html#Labs-ref">
					Labs <span>(1)</span>
					
				</a></li>
			
		  
		</ul>
		  

		  

		<hr>

		<div>
      <section class="share col-sm-6">
        <h4 class="section-title">Share Post</h4>
        <a class="btn btn-default btn-sm twitter" href="https://twitter.com/share?text=Setting up a lab with VMWare workstation&via=raesene"
           onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
          <i class="fa fa-twitter fa-lg"></i>
          Twitter
        </a>
        <a class="btn btn-default btn-sm facebook" href="https://www.facebook.com/sharer/sharer.php"
           onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
          <i class="fa fa-facebook fa-lg"></i>
          Facebook
        </a>
        <a class="btn btn-default btn-sm gplus"
           onclick="window.open('https://plus.google.com/share?url='+window.location.href, 'google-plus-share', 'width=490,height=530');return false;">
          <i class="fa fa-google-plus fa-lg"></i>
          Google+
        </a>
      </section>

      <section class="col-sm-6 author">
        <img src="https://www.gravatar.com/avatar/8c189c784a607c4b5d52b0c7ee69b036" class="img-rounded author-image" />
        <h4 class="section-title author-name">raesene</h4>
        <p class="author-bio">Security Geek, Penetration Testing, Docker, Ruby, Hillwalking</p>
      </section>
    </div>

    <div class="clearfix"></div>

		<ul class="pager">
		  
		  <li class="previous"><a href="/blog/2014/04/17/changing-times-the-end-of-autocomplete-equals-off/" title="Changing Times - The end of Autocomplete='off'">&larr; Previous</a></li>
		  
		  
		  <li class="next"><a href="/blog/2014/06/08/finding-security/" title="Finding security">Next &rarr;</a></li>
		  
		</ul>

		<hr>
	</div>
	
	<div class="col-sm-2 sidebar-2">
	
	</div>
</article>
<div class="clearfix"></div>



    
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'raesene';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>





		<footer>
			<hr/>
			<p>
				&copy; 2021 raesene with Jekyll. Theme: <a href="https://github.com/dbtek/dbyll">dbyll</a> by dbtek.
			</p>
		</footer>
	</div>

	<script type="text/javascript" src="/assets/resources/jquery/jquery.min.js"></script>
	<script type="text/javascript" src="/assets/resources/bootstrap/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="/assets/js/app.js"></script>
</body>
</html>


