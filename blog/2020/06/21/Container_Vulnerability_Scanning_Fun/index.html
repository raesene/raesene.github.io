<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Container Vulnerability Scanning Fun</title>
	
	<meta name="author" content="raesene">

	<!-- Enable responsive viewport -->
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

	<!-- Le styles -->
	<link href="https://raesene.github.io/assets/resources/bootstrap/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://raesene.github.io/assets/resources/font-awesome/css/font-awesome.min.css" rel="stylesheet">
	<link href="https://raesene.github.io/assets/resources/syntax/syntax.css" rel="stylesheet">
	<link href="https://raesene.github.io/assets/css/style.css" rel="stylesheet">

	<!-- Le fav and touch icons -->
	<!-- Update these with your own images
	<link rel="shortcut icon" href="images/favicon.ico">
	<link rel="apple-touch-icon" href="images/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
	-->

	<link rel="alternate" type="application/rss+xml" title="" href="https://raesene.github.io/feed.xml">
</head>

<body>
	<nav class="navbar navbar-default visible-xs" role="navigation">
		<!-- Brand and toggle get grouped for better mobile display -->
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			
			<a type="button" class="navbar-toggle nav-link" href="https://github.com/raesene">
				<i class="fa fa-github"></i>
			</a>
			
			
			<a type="button" class="navbar-toggle nav-link" href="https://twitter.com/raesene">
				<i class="fa fa-twitter"></i>
			</a>
			
			
			<a type="button" class="navbar-toggle nav-link" href="mailto:raesene@gmail.com">
				<i class="fa fa-envelope"></i>
			</a>
			
			<a class="navbar-brand" href="https://raesene.github.io/">
				<img src="https://www.gravatar.com/avatar/8c189c784a607c4b5d52b0c7ee69b036?s=35" class="img-circle" />
				Raesene's Ramblings
			</a>
		</div>

		<!-- Collect the nav links, forms, and other content for toggling -->
		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			<ul class="nav navbar-nav">
				<li class="active"><a href="https://raesene.github.io/">Home</a></li>
				<li><a href="https://raesene.github.io/categories/index.html">Categories</a></li>
				<li><a href="https://raesene.github.io/tags/index.html">Tags</a></li>
			</ul>
		</div><!-- /.navbar-collapse -->
	</nav>

	<!-- nav-menu-dropdown -->
	<div class="btn-group hidden-xs" id="nav-menu">
		<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
			<i class="fa fa-bars"></i>
		</button>
		<ul class="dropdown-menu" role="menu">
			<li><a href="https://raesene.github.io/"><i class="fa fa-home"></i>Home</a></li>
			<li><a href="https://raesene.github.io/categories/index.html"><i class="fa fa-folder"></i>Categories</a></li>
			<li><a href="https://raesene.github.io/tags/index.html"><i class="fa fa-tags"></i>Tags</a></li>
			<li class="divider"></li>
			<li><a href="#"><i class="fa fa-arrow-up"></i>Top of Page</a></li>
		</ul>
	</div>

	<div class="col-sm-3 sidebar hidden-xs">
		<!-- sidebar.html -->
<header class="sidebar-header" role="banner">
	<a href="https://raesene.github.io/">
		<img src="https://www.gravatar.com/avatar/8c189c784a607c4b5d52b0c7ee69b036?s=150" class="img-circle" />
	</a>
	<h3 class="title">
        <a href="https://raesene.github.io/">Raesene's Ramblings</a>
    </h3>
</header>


<div id="bio" class="text-center">
	Security Geek, Penetration Testing, Docker, Ruby, Hillwalking
</div>


<div id="contact-list" class="text-center">
	<ul class="list-unstyled list-inline">
		
		<li>
			<a class="btn btn-default btn-sm" href="https://github.com/raesene">
				<i class="fa fa-github-alt fa-lg"></i>
			</a>
		</li>
		
		
		<li>
			<a class="btn btn-default btn-sm" href="https://twitter.com/raesene">
				<i class="fa fa-twitter fa-lg"></i>
			</a>
		</li>
		
		
		<li>
			<a class="btn btn-default btn-sm" href="mailto:raesene@gmail.com">
				<i class="fa fa-envelope fa-lg"></i>
			</a>
		</li>
		
	</ul>
	<ul id="contact-list-secondary" class="list-unstyled list-inline">
		
		
		<li>
			<a class="btn btn-default btn-sm" href="https://linkedin.com/in/rorym">
				<i class="fa fa-linkedin fa-lg"></i>
			</a>
		</li>
		
		<li>
			<a class="btn btn-default btn-sm" href="https://raesene.github.io/feed.xml">
				<i class="fa fa-rss fa-lg"></i>
			</a>
		</li>
	</ul>
</div>
<!-- sidebar.html end -->

	</div>

	<div class="col-sm-9 col-sm-offset-3">
		<div class="page-header">
  <h1>Container Vulnerability Scanning Fun </h1>
</div>
	
<article>

	<div class="col-sm-10">
	 <span class="post-date">
	   
	   June 
	   21st,
	     
	   2020
	 </span>
	  <div class="article_body">
	  <p>Vulnerability Assessment is one of those foundational IT Security tasks that often gets overlooked or thought to be reasonably straightforward, where you can actually find some interesting complications that make it trickier than expected.</p>

<p>Generally, most companies will include VA as part of their overall operational security processes, looking to assure that the software they’re deploying is relatively free of unpatched security vulnerabilities.</p>

<p>This post will look a bit at how assessing vulnerabilities of container images for outdated operating system packages is handled and some things to be aware of. We’ll exclude Windows container images to keep things (relatively) straightforward and stick to operating system level vulnerabilities.</p>

<h1 id="overview">Overview</h1>

<p>Most Docker images are based on specific Linux distributions and make use of the package managers that those distributions provide to deploy software like tooling and libraries that support the application running in containers based on that image.</p>

<p>So if we’re looking to assess whether there are known vulnerabilities in our images, it would seem possible to use the data provided by the distributions about package versions and CVEs that are patched in them, to assess whether a given image has unpatched vulnerabilities, so far … so simple!</p>

<h2 id="tooling">Tooling</h2>

<p>To take a practical look at how this works, we can use some of the Open Source container vulnerability scanning tools that are available.  For this post we’ll look at three</p>

<ul>
  <li><a href="https://github.com/anchore/anchore-engine">Anchore Engine</a></li>
  <li><a href="https://github.com/quay/clair">Clair</a></li>
  <li><a href="https://github.com/aquasecurity/trivy">Trivy</a></li>
</ul>

<p>For the examples below, I set up all three scanners to run locally (e.g. without setting up a container registry).  For Anchore I used their Docker compose file and <a href="https://github.com/anchore/anchore-cli">Ancore CLI</a>, for clair I used <a href="https://github.com/arminc/clair-local-scan">clair-local-scan</a> and for Trivy, I just used the binary as it comes from their repo. A side note on these is that, from the perspective of setup processes for standalone usage, Trivy is by far the easiest to get working.</p>

<h2 id="scanning-common-base-images">Scanning Common Base Images</h2>

<p>So now we’ve got three scanners setup, let’s take a look at some common base images and see what they come up with. All three tools provide a JSON output option, so we can use that to create parseable results for analysis.</p>

<p><strong>TL;DR.</strong></p>

<p>If you don’t want to read down a couple of points to note</p>

<ul>
  <li>Despite the task seeming relatively simple, even in base images different container vulnerability scanners produce quite different results</li>
  <li>The scanning engines support different sets of base images, so that should be noted when you’re assessing which one to use</li>
  <li>Even in a fully updated base image, there can still be outstanding CVEs, depending on the update cycle of both Docker Hub and the underlying distribution.</li>
</ul>

<p><strong>Summary of Vulnerability Numbers</strong></p>

<table>
  <thead>
    <tr>
      <th> </th>
      <th>Ubuntu:18.04</th>
      <th>Ubuntu:20.04</th>
      <th>Debian:stable</th>
      <th>Centos:8</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Anchore</td>
      <td>71</td>
      <td>23</td>
      <td>47</td>
      <td>74</td>
    </tr>
    <tr>
      <td>Clair</td>
      <td>38</td>
      <td>0</td>
      <td>89</td>
      <td>1</td>
    </tr>
    <tr>
      <td>Trivy</td>
      <td>73</td>
      <td>26</td>
      <td>88</td>
      <td>N/A</td>
    </tr>
  </tbody>
</table>

<h1 id="result-details">Result Details</h1>

<h2 id="ubuntu1804">Ubuntu:18.04</h2>

<p>This is a very commonly used base image.  We’re using the latest version with that tag from Docker Hub.  First question is, when we scan this image, how many vulnerabilities does each scanner think we have?</p>

<p><strong>Vulnerability Count</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Anchore thinks the vuln count is : 71
Clair thinks the vuln count is : 38
Trivy thinks the vuln count is : 73
</code></pre></div></div>

<p>This is moderately interesting already.  If you’re using an updated image from Docker Hub, you might think there would be no unpatched issues, but you’d be wrong. One interesting piece about these issue counts is that (in this case) it turns out that the CVEs referenced are the same but that some of the scanners have multiple vulnerabilities for a single CVE.</p>

<p>Next question, what severity do the various scanners apply to these vulnerabilities</p>

<p><strong>Vulnerability Severities</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Anchore Severity Counts : <span class="o">{</span><span class="s2">"Low"</span><span class="o">=&gt;</span>31, <span class="s2">"Negligible"</span><span class="o">=&gt;</span>23, <span class="s2">"Medium"</span><span class="o">=&gt;</span>17<span class="o">}</span>
Clair Severity Counts : <span class="o">{</span><span class="s2">"Medium"</span><span class="o">=&gt;</span>11, <span class="s2">"Low"</span><span class="o">=&gt;</span>20, <span class="s2">"Negligible"</span><span class="o">=&gt;</span>7<span class="o">}</span>
Trivy Severity Counts : <span class="o">{</span><span class="s2">"LOW"</span><span class="o">=&gt;</span>55, <span class="s2">"MEDIUM"</span><span class="o">=&gt;</span>18<span class="o">}</span>
</code></pre></div></div>

<p>Some relatively major differences there too.</p>

<h2 id="ubuntu2004">Ubuntu:20.04</h2>

<p>Lets try the newest stable release of Ubuntu and see what that shows up. Here, Clair doesn’t notice any issues whilst both Anchore and Trivy report over twenty</p>

<p><strong>Vulnerability Count</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Anchore thinks the vuln count is : 23
Clair thinks the vuln count is : 0
Trivy thinks the vuln count is : 26
</code></pre></div></div>

<p>On severities, Trivy includes a high, where all of Anchore’s severities are medium or low.</p>

<p><strong>Vulnerability Severities</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Anchore Severity Counts : <span class="o">{</span><span class="s2">"Low"</span><span class="o">=&gt;</span>11, <span class="s2">"Negligible"</span><span class="o">=&gt;</span>5, <span class="s2">"Medium"</span><span class="o">=&gt;</span>7<span class="o">}</span>
Clair Severity Counts : <span class="o">{}</span>
Trivy Severity Counts : <span class="o">{</span><span class="s2">"MEDIUM"</span><span class="o">=&gt;</span>9, <span class="s2">"LOW"</span><span class="o">=&gt;</span>16, <span class="s2">"HIGH"</span><span class="o">=&gt;</span>1<span class="o">}</span>
</code></pre></div></div>

<h2 id="debianstable">Debian:stable</h2>

<p>Here the numbers are switched around again with Clair and Trivy reporting quite a few more issues than Anchore. An interesting point is that whilst Clair and Trivy’s total vulnerability counts are similar, the referenced CVEs have quite a few differences.</p>

<p><strong>Vulnerability Count</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Anchore thinks the vuln count is : 47
Clair thinks the vuln count is : 89
Trivy thinks the vuln count is : 88
</code></pre></div></div>

<p><strong>Vulnerability severity</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Anchore Severity Counts : <span class="o">{</span><span class="s2">"Negligible"</span><span class="o">=&gt;</span>46, <span class="s2">"Medium"</span><span class="o">=&gt;</span>1<span class="o">}</span>
Clair Severity Counts : <span class="o">{</span><span class="s2">"Low"</span><span class="o">=&gt;</span>21, <span class="s2">"Negligible"</span><span class="o">=&gt;</span>45, <span class="s2">"Unknown"</span><span class="o">=&gt;</span>23<span class="o">}</span>
Trivy Severity Counts : <span class="o">{</span><span class="s2">"LOW"</span><span class="o">=&gt;</span>69, <span class="s2">"MEDIUM"</span><span class="o">=&gt;</span>17, <span class="s2">"HIGH"</span><span class="o">=&gt;</span>2<span class="o">}</span>
</code></pre></div></div>

<h2 id="centos8">Centos:8</h2>

<p>Another commonly used base image here the results are interesting, in that Trivy doesn’t recognize the OS at all and Anchore comes out with a lot more vulnerabilities than Clair.</p>

<p><strong>Vulnerability Count</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Anchore thinks the vuln count is : 74
Clair thinks the vuln count is : 1
Trivy thinks the vuln count is : 0
</code></pre></div></div>

<p><strong>Vulnerability Severities</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Anchore Severity Counts : <span class="o">{</span><span class="s2">"Low"</span><span class="o">=&gt;</span>23, <span class="s2">"High"</span><span class="o">=&gt;</span>4, <span class="s2">"Medium"</span><span class="o">=&gt;</span>47<span class="o">}</span>
Clair Severity Counts : <span class="o">{</span><span class="s2">"High"</span><span class="o">=&gt;</span>1<span class="o">}</span>
Trivy Severity Counts : <span class="o">{}</span>
</code></pre></div></div>

	  </div>

		
		<ul class="tag_box list-unstyled list-inline">
		  <li><i class="fa fa-folder-open"></i></li>
		  
		  
			 
				<li><a href="https://raesene.github.io/categories/index.html#Docker-ref">
					Docker <span>(23)</span>
					
				</a></li>
			
		  
		</ul>
		  

		  

		<hr>

		<div>
      <section class="share col-sm-6">
        <h4 class="section-title">Share Post</h4>
        <a class="btn btn-default btn-sm twitter" href="https://twitter.com/share?text=Container Vulnerability Scanning Fun&via=raesene"
           onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
          <i class="fa fa-twitter fa-lg"></i>
          Twitter
        </a>
        <a class="btn btn-default btn-sm facebook" href="https://www.facebook.com/sharer/sharer.php"
           onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
          <i class="fa fa-facebook fa-lg"></i>
          Facebook
        </a>
        <a class="btn btn-default btn-sm gplus"
           onclick="window.open('https://plus.google.com/share?url='+window.location.href, 'google-plus-share', 'width=490,height=530');return false;">
          <i class="fa fa-google-plus fa-lg"></i>
          Google+
        </a>
      </section>

      <section class="col-sm-6 author">
        <img src="https://www.gravatar.com/avatar/8c189c784a607c4b5d52b0c7ee69b036" class="img-rounded author-image" />
        <h4 class="section-title author-name">raesene</h4>
        <p class="author-bio">Security Geek, Penetration Testing, Docker, Ruby, Hillwalking</p>
      </section>
    </div>

    <div class="clearfix"></div>

		<ul class="pager">
		  
		  <li class="previous"><a href="https://raesene.github.io/blog/2020/05/31/Custom_Pentest_Distributions_With_WSL2/" title="Custom Pentest Distributions using WSL2">&larr; Previous</a></li>
		  
		  
		  <li class="next"><a href="https://raesene.github.io/blog/2020/11/22/When_Is_A_Vulnerability_Not_A_Vulnerability/" title="When is a Vulnerability (possibly) not a vulnerability">Next &rarr;</a></li>
		  
		</ul>

		<hr>
	</div>
	
	<div class="col-sm-2 sidebar-2">
	
	</div>
</article>
<div class="clearfix"></div>





		<footer>
			<hr/>
			<p>
				&copy; 2021 raesene with Jekyll. Theme: <a href="https://github.com/dbtek/dbyll">dbyll</a> by dbtek.
			</p>
		</footer>
	</div>

	<script type="text/javascript" src="https://raesene.github.io/assets/resources/jquery/jquery.min.js"></script>
	<script type="text/javascript" src="https://raesene.github.io/assets/resources/bootstrap/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="https://raesene.github.io/assets/js/app.js"></script>
</body>
</html>


